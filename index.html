<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="日向坂46の最新YouTube動画と関連ニュースをまとめた非公式ファンサイト。">
  <title>日向坂46まとめサイト</title>
  <style>
    body { font-family: sans-serif; margin: 0; background: #f8f9fa; }
    header, nav, main { padding: 1rem; }
    header { background: #4fc3f7; color: white; text-align: center; }
    nav button { margin: 0.5rem; padding: 0.5rem 1rem; cursor: pointer; background: #4fc3f7; color: white; border: none; border-radius: 4px; }
    section { display: none; margin-top: 1rem; }
    section.active { display: block; }
    .video, .news-item { display: flex; gap: 1rem; background: white; padding: 1rem; margin-bottom: 1rem; border-radius: 8px; box-shadow: 0 0 5px #ccc; }
    .video img, .news-item img { width: 120px; height: auto; border-radius: 4px; object-fit: cover; }
    .video .info, .news-item .info { flex: 1; }
    .controls { margin-bottom: 1rem; }
  </style>
</head>
<body>
  <header>
    <h1>日向坂46 最新まとめ</h1>
  </header>

  <nav>
    <button onclick="switchView('youtube')">YouTube</button>
    <button onclick="switchView('news')">関連ニュース</button>
  </nav>

  <main>
    <section id="youtube">
      <div class="controls">
        <label>チャンネル: 
          <select id="channelSelect" onchange="loadYouTube()">
            <option value="UCR0V48DJyWbwEAdxLL5FjxA">日向坂46 OFFICIAL</option>
            <option value="UCOB24f8lQBCnVqPZXOkVpOg">日向坂ちゃんねる</option>
          </select>
        </label>
        <button onclick="sortYouTube(true)">新しい順</button>
        <button onclick="sortYouTube(false)">古い順</button>
      </div>
      <div id="youtubeList"></div>
    </section>

    <section id="news">
      <div class="controls">
        <button onclick="sortNews(true)">新しい順</button>
        <button onclick="sortNews(false)">古い順</button>
      </div>
      <div id="newsList"></div>
    </section>
  </main>

  <script>
    let youtubeEntries = [];
    let newsEntries = [];

    function switchView(view) {
      document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
      document.getElementById(view).classList.add('active');
    }

    async function loadYouTube() {
      const channelId = document.getElementById("channelSelect").value;
      const url = `https://www.youtube.com/feeds/videos.xml?channel_id=${channelId}`;
      const res = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(url)}`);
      const data = await res.json();
      const parser = new DOMParser();
      const xml = parser.parseFromString(data.contents, "text/xml");
      youtubeEntries = Array.from(xml.querySelectorAll("entry")).map(entry => {
        const videoId = entry.querySelector("yt\\:videoId").textContent;
        return {
          title: entry.querySelector("title").textContent,
          link: entry.querySelector("link").getAttribute("href"),
          published: new Date(entry.querySelector("published").textContent),
          thumbnail: `https://i.ytimg.com/vi/${videoId}/hqdefault.jpg`
        };
      });
      sortYouTube(true);
    }

    function sortYouTube(desc = true) {
      const list = document.getElementById("youtubeList");
      const sorted = youtubeEntries.sort((a, b) => desc ? b.published - a.published : a.published - b.published);
      list.innerHTML = sorted.map(v => `
        <div class="video">
          <img src="${v.thumbnail}" alt="Thumbnail">
          <div class="info">
            <a href="${v.link}" target="_blank">${v.title}</a><br>
            <small>${v.published.toLocaleString()}</small>
          </div>
        </div>
      `).join('');
    }

    async function loadNews() {
      const newsFeedUrl = "https://news.google.com/rss/search?q=%E6%97%A5%E5%90%91%E5%9D%8246&hl=ja&gl=JP&ceid=JP:ja";
      const res = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(newsFeedUrl)}`);
      const data = await res.json();
      const parser = new DOMParser();
      const xml = parser.parseFromString(data.contents, "text/xml");
      newsEntries = Array.from(xml.querySelectorAll("item")).map(item => ({
        title: item.querySelector("title").textContent,
        link: item.querySelector("link").textContent,
        pubDate: new Date(item.querySelector("pubDate").textContent),
        image: "https://placehold.co/120x90?text=News" // プレースホルダー画像
      }));
      sortNews(true);
    }

    function sortNews(desc = true) {
      const list = document.getElementById("newsList");
      const sorted = newsEntries.sort((a, b) => desc ? b.pubDate - a.pubDate : a.pubDate - b.pubDate);
      list.innerHTML = sorted.map(n => `
        <div class="news-item">
          <img src="${n.image}" alt="News Thumbnail">
          <div class="info">
            <a href="${n.link}" target="_blank">${n.title}</a><br>
            <small>${n.pubDate.toLocaleString()}</small>
          </div>
        </div>
      `).join('');
    }

    // 初期読み込み
    loadYouTube();
    loadNews();
    switchView('youtube');
  </script>
</body>
</html>
